{"version":3,"file":"eventmanager.js","sources":["../src/uuidv4.js","../src/EventManager.js"],"sourcesContent":["/**\n * This is borrowed from https://gist.github.com/jed/982883\n * because the uuid most popular package is using a node dep\n */\n\nexport default function uuidv4(a){\n  return a?(a^Math.random()*16>>a/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,uuidv4)\n}\n","import uuidv4 from './uuidv4'\n\n\n/**\n * The EventManager deals with events, create them, call them.\n * This class is mostly for being inherited from.\n */\nclass EventManager {\n  /**\n   * Constructor\n   * @param {boolean} enabled - if true (default), the events emitting is enabled, if false, they won't be fired.\n   */\n  constructor(enabled=true) {\n    this._events = {}\n    this._enabled = enabled\n\n    // by event hash, stores the even name and the callback, in order to remove it\n    // efficiently\n    this._eventIndex = {}\n  }\n\n\n  /**\n   * Tells how many events are registered under this event name\n   * @return {number}\n   */\n  countEvents(eventName){\n    if(eventName in this._events){\n      return this._events[eventName].length\n    }else{\n      return 0\n    }\n  }\n\n\n  /**\n   * This way, the events are not emitted\n   */\n  disableEvents() {\n    this._enabled = false\n  }\n\n\n  /**\n   * This way, the events are properly emitted\n   */\n  enableEvents() {\n    this._enabled = true\n  }\n\n  /**\n   * Define an event, with a name associated with a function\n   * @param  {String} eventName - Name to give to the event\n   * @param  {Function} callback - function associated to the even\n   * @return {string|null} the eventId (useful to remove it) or null if the event couldnt be added\n   */\n  on(eventName, callback) {\n    if (typeof callback === 'function') {\n      if (!(eventName in this._events)) {\n        this._events[eventName] = []\n      }\n\n      let eventId = uuidv4()\n      this._eventIndex[eventId] = {\n        eventName: eventName,\n        callback: callback\n      }\n\n      this._events[eventName].push(eventId)\n\n      return eventId\n    } else {\n      console.warn('The callback must be of type Function')\n    }\n\n    return null\n  }\n\n\n  /**\n   * Emit the event, run the functions attached to it\n   * @param {string} eventName - the name of the event to run\n   * @param {Array} args - array of arguments the event callbacks are going to be called with (with destructuring operator)\n   */\n  emit(eventName, args = []) {\n    if(!this._enabled){\n      return\n    }\n\n    // the event must exist and be non null\n    if ((eventName in this._events) && (this._events[eventName].length > 0)) {\n      const events = this._events[eventName]\n      for (let i = 0; i < events.length; i += 1) {\n        this._eventIndex[events[i]].callback(...args)\n      }\n    } else {\n      //console.warn(`No function associated to the event ${eventName}`)\n    }\n  }\n\n\n  /**\n   * Emit the event, run the functions attached to it in a async fashion\n   * @param {string} eventName - the name of the event to run\n   * @param {Array} args - array of arguments the event callbacks are going to be called with (with destructuring operator)\n   */\n   async emitAsync(eventName, args = []) {\n    if(!this._enabled){\n      return\n    }\n\n    // the event must exist and be non null\n    if ((eventName in this._events) && (this._events[eventName].length > 0)) {\n      const events = this._events[eventName]\n      for (let i = 0; i < events.length; i += 1) {\n        await this._eventIndex[events[i]].callback(...args)\n      }\n    } else {\n      //console.warn(`No function associated to the event ${eventName}`)\n    }\n  }\n\n\n  /**\n   * Delete an event using its id\n   * @param {string} id - id of the event (returned by the `.on()` method)\n   */\n  delete(eventId) {\n    if(!(eventId in this._eventIndex)){\n      console.log(`No event of id ${eventId}.`)\n      return\n    }\n\n    // array of events of the same name as eventId\n    let eventOfSameName = this._events[this._eventIndex[eventId].eventName]\n    let index = eventOfSameName.indexOf(eventId)\n\n    delete this._eventIndex[eventId]\n\n    if(index !== -1) {\n      eventOfSameName.splice(index, 1)\n    }\n\n    if(eventOfSameName.length === 0){\n      delete this._events[this._eventIndex[eventId].eventName]\n    }\n  }\n\n\n}\n\nexport default EventManager\n"],"names":[],"mappings":"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"}